<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Be My Valentine?</title>

  <style>
    :root{
      --pink:#ff4d8d;
      --pink2:#ff85b3;
      --bg1:#fff0f6;
      --bg2:#fff7fb;
      --text:#222;
      --card:#ffffff;
      --shadow: 0 18px 50px rgba(255,77,141,.18);
    }

    *{ box-sizing:border-box; }
    body{
      margin:0;
      font-family: system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif;
      color:var(--text);
      min-height:100vh;
      display:flex;
      align-items:center;
      justify-content:center;
      padding:22px;
      background: radial-gradient(circle at 20% 20%, var(--bg1), var(--bg2));
      overflow:hidden;
    }

    /* ===== Hearts Rain ===== */
    #rain{
      position:fixed; inset:0;
      pointer-events:none;
      z-index:0;
      overflow:hidden;
    }
    .h{
      position:absolute;
      top:-40px;
      width:16px;height:16px;
      background: rgba(255,133,179,.55);
      transform: rotate(45deg);
      border-radius:4px;
      animation: fall linear forwards;
      filter: drop-shadow(0 6px 10px rgba(255,77,141,.14));
    }
    .h:before,.h:after{
      content:"";
      position:absolute;
      width:16px;height:16px;
      background: rgba(255,133,179,.55);
      border-radius:50%;
    }
    .h:before{ left:-8px; top:0; }
    .h:after{ left:0; top:-8px; }

    @keyframes fall{
      0%   { transform: translateY(-60px) rotate(45deg); opacity:0; }
      10%  { opacity:1; }
      100% { transform: translateY(120vh) rotate(45deg); opacity:0; }
    }

    /* ===== Main Card ===== */
    .card{
      width:min(820px, 100%);
      background:var(--card);
      border-radius:24px;
      box-shadow: var(--shadow);
      padding:18px;
      position:relative;
      z-index:2;
      border: 1px solid rgba(255,77,141,.10);
    }

    .topRow{
      display:grid;
      grid-template-columns: 1.1fr .9fr;
      gap:14px;
      align-items:stretch;
    }
    @media (max-width: 780px){
      .topRow{ grid-template-columns: 1fr; }
    }

    .hero{
      border-radius:18px;
      overflow:hidden;
      border: 2px solid rgba(255,77,141,.13);
      background:
        radial-gradient(circle at 25% 30%, rgba(255,133,179,.35), transparent 55%),
        radial-gradient(circle at 80% 20%, rgba(255,77,141,.25), transparent 55%),
        linear-gradient(135deg, #ffe3ee, #fff);
      aspect-ratio: 16 / 10;
      position:relative;
      display:flex;
      align-items:center;
      justify-content:center;
      padding:16px;
      text-align:center;
    }
    .hero h2{
      margin:0;
      font-size:clamp(18px, 3.2vw, 26px);
      line-height:1.15;
    }
    .hero p{
      margin:8px 0 0;
      opacity:.8;
      font-weight:600;
    }

    .panel{
      border-radius:18px;
      border: 2px solid rgba(255,77,141,.10);
      background: linear-gradient(180deg, rgba(255,77,141,.08), rgba(255,133,179,.06));
      padding:12px;
      display:flex;
      flex-direction:column;
      gap:10px;
    }

    /* ===== Loader ===== */
    .loaderBox{
      background:#fff;
      border-radius:16px;
      padding:12px;
      border:1px solid rgba(0,0,0,.06);
    }
    .loaderTop{
      display:flex;
      justify-content:space-between;
      align-items:center;
      gap:10px;
      font-weight:900;
      margin-bottom:8px;
    }
    .bar{
      height:12px;
      background: rgba(0,0,0,.06);
      border-radius:999px;
      overflow:hidden;
    }
    .bar > div{
      height:100%;
      width:0%;
      background: linear-gradient(135deg, var(--pink), var(--pink2));
      border-radius:999px;
      transition: width .2s ease;
    }
    .note{
      margin-top:8px;
      font-size:12px;
      opacity:.75;
      font-weight:700;
    }

    /* ===== Polaroids (no external images needed) ===== */
    .polaroids{
      display:grid;
      grid-template-columns: repeat(3, 1fr);
      gap:8px;
    }
    @media (max-width: 780px){
      .polaroids{ grid-template-columns: repeat(2, 1fr); }
    }
    .pol{
      background:#fff;
      border-radius:14px;
      padding:8px 8px 12px;
      box-shadow: 0 14px 30px rgba(0,0,0,.08);
      border:1px solid rgba(0,0,0,.06);
      transform: rotate(var(--r));
    }
    .polPic{
      width:100%;
      aspect-ratio: 1 / 1;
      border-radius:10px;
      background:
        radial-gradient(circle at 30% 30%, rgba(255,133,179,.35), transparent 55%),
        radial-gradient(circle at 70% 60%, rgba(255,77,141,.25), transparent 55%),
        linear-gradient(135deg, #ffe3ee, #fff);
      border: 1px solid rgba(0,0,0,.06);
    }
    .cap{
      margin-top:8px;
      font-size:12px;
      font-weight:900;
      opacity:.8;
      text-align:center;
    }

    h1{
      margin:14px 0 6px;
      font-size: clamp(22px, 4.5vw, 34px);
      line-height:1.1;
      text-align:center;
    }
    .sub{
      margin:0 0 10px;
      opacity:.82;
      text-align:center;
      font-weight:600;
    }

    .buttons{
      display:flex;
      gap:12px;
      justify-content:center;
      flex-wrap:wrap;
      margin-top:12px;
      position:relative;
      height:74px;
    }
    button{
      border:0;
      padding:14px 20px;
      border-radius:999px;
      font-size:16px;
      font-weight:900;
      cursor:pointer;
      transition: transform .12s ease, box-shadow .12s ease;
      user-select:none;
      min-width:150px;
    }
    #yes{
      background: linear-gradient(135deg, var(--pink), var(--pink2));
      color:#fff;
      box-shadow: 0 10px 22px rgba(255,77,141,.35);
    }
    #yes:hover{ transform: translateY(-1px) scale(1.02); }

    #no{
      background:#f2f2f2;
      color:#444;
      box-shadow: 0 8px 18px rgba(0,0,0,.06);
      position:relative;
    }

    .result{
      margin-top:10px;
      font-size:18px;
      font-weight:900;
      min-height:26px;
      text-align:center;
    }
    .tiny{
      margin-top:6px;
      font-size:12px;
      opacity:.65;
      text-align:center;
      font-weight:700;
    }

    /* ===== Fireworks/confetti ===== */
    #fx{
      position:fixed; inset:0;
      pointer-events:none;
      z-index:6;
      overflow:hidden;
    }
    .spark{
      position:absolute;
      width:10px;height:10px;
      border-radius:50%;
      animation: burst 900ms ease-out forwards;
      opacity:.95;
      filter: drop-shadow(0 6px 10px rgba(0,0,0,.12));
    }
    @keyframes burst{
      from{ transform: translate(0,0) scale(1); }
      to{ transform: translate(var(--dx), var(--dy)) scale(0.2); opacity:0; }
    }

    /* ===== Secret Letter Modal ===== */
    .modalBg{
      position:fixed; inset:0;
      background: rgba(0,0,0,.35);
      display:none;
      align-items:center;
      justify-content:center;
      padding:18px;
      z-index:10;
    }
    .modal{
      width:min(620px, 100%);
      background:#fff;
      border-radius:22px;
      box-shadow: 0 22px 60px rgba(0,0,0,.18);
      border:1px solid rgba(255,77,141,.18);
      overflow:hidden;
      transform: translateY(10px);
      animation: popIn .18s ease-out forwards;
    }
    @keyframes popIn{
      to{ transform: translateY(0); }
    }
    .modalTop{
      display:flex;
      justify-content:space-between;
      align-items:center;
      gap:10px;
      padding:12px 14px;
      background: linear-gradient(135deg, rgba(255,77,141,.10), rgba(255,133,179,.08));
      border-bottom: 1px solid rgba(0,0,0,.06);
      font-weight:900;
    }
    .tabs{
      display:flex;
      gap:8px;
      padding:10px 14px;
      background:#fff;
      border-bottom: 1px solid rgba(0,0,0,.06);
    }
    .tab{
      padding:10px 12px;
      border-radius:999px;
      border:1px solid rgba(0,0,0,.10);
      background:#fff;
      font-weight:900;
      cursor:pointer;
    }
    .tab.active{
      border-color: rgba(255,77,141,.35);
      background: rgba(255,77,141,.10);
    }
    .modalBody{
      padding:14px;
    }
    .closeBtn{
      border:0;
      background:#fff;
      border-radius:999px;
      padding:10px 12px;
      font-weight:900;
      cursor:pointer;
      border:1px solid rgba(0,0,0,.10);
    }

    /* iMessage look */
    .imessage{
      background: #f5f5f7;
      border-radius:18px;
      padding:12px;
      border:1px solid rgba(0,0,0,.06);
    }
    .bubble{
      max-width: 92%;
      padding:10px 12px;
      border-radius:18px;
      margin:8px 0;
      font-weight:800;
      line-height:1.25;
    }
    .bubble.them{
      background:#fff;
      border:1px solid rgba(0,0,0,.08);
      border-bottom-left-radius:6px;
    }
    .bubble.me{
      margin-left:auto;
      background: linear-gradient(135deg, var(--pink), var(--pink2));
      color:#fff;
      border-bottom-right-radius:6px;
    }
    .time{
      text-align:center;
      font-size:12px;
      opacity:.65;
      font-weight:800;
      margin:6px 0 10px;
    }

    /* Handwritten look */
    .letter{
      background:
        linear-gradient(transparent 30px, rgba(255,77,141,.08) 31px),
        #fffdf8;
      background-size: 100% 31px;
      border-radius:18px;
      padding:14px;
      border:1px solid rgba(0,0,0,.06);
    }
    .letter h3{
      margin:0 0 6px;
      font-family: "Comic Sans MS", "Bradley Hand", "Marker Felt", cursive;
      font-size:22px;
    }
    .letter p{
      margin:8px 0;
      font-family: "Comic Sans MS", "Bradley Hand", "Marker Felt", cursive;
      font-size:18px;
      line-height:1.25;
      font-weight:700;
    }
  </style>
</head>

<body>
  <div id="rain"></div>
  <div id="fx"></div>

  <main class="card" aria-live="polite">

    <div class="topRow">
      <div class="hero">
        <div>
          <h2>üå∏ Valentine Mission üå∏<br>One question. One answer.</h2>
          <p>(Warning: extremely cute website ahead)</p>
        </div>
      </div>

      <div class="panel">
        <div class="loaderBox">
          <div class="loaderTop">
            <span id="loaderTitle">Calculating compatibility‚Ä¶</span>
            <span id="pct">0%</span>
          </div>
          <div class="bar"><div id="fill"></div></div>
          <div class="note" id="note">Please stand by. Romance science in progress.</div>
        </div>

        <div class="polaroids">
          <div class="pol" style="--r:-3deg">
            <div class="polPic"></div>
            <div class="cap">little moments</div>
          </div>
          <div class="pol" style="--r:2deg">
            <div class="polPic"></div>
            <div class="cap">big smiles</div>
          </div>
          <div class="pol" style="--r:-1deg">
            <div class="polPic"></div>
            <div class="cap">our vibe</div>
          </div>
        </div>

        <div class="tiny">Heartbeat will start after your first tap/click üíì</div>
      </div>
    </div>

    <h1 id="title">Will you be my Valentine? üíñ</h1>
    <p class="sub" id="sub">I made this just for you.</p>

    <div class="buttons" id="area">
      <button id="yes">Yes üòç</button>
      <button id="no">No üôà</button>
    </div>

    <div class="result" id="result"></div>
    <div class="tiny">Pro tip: if ‚ÄúNo‚Äù starts acting weird‚Ä¶ it‚Äôs not your fault üôÇ</div>
  </main>

  <!-- Secret Letter Modal -->
  <div class="modalBg" id="modalBg">
    <div class="modal" role="dialog" aria-modal="true" aria-labelledby="modalTitle">
      <div class="modalTop">
        <div id="modalTitle">Secret message unlocked üîì</div>
        <button class="closeBtn" id="closeModal">Close</button>
      </div>

      <div class="tabs">
        <button class="tab active" id="tabMsg">iMessage</button>
        <button class="tab" id="tabLetter">Handwritten</button>
      </div>

      <div class="modalBody">
        <!-- iMessage view -->
        <div id="viewMsg">
          <div class="imessage">
            <div class="time" id="msgTime">Today</div>
            <div class="bubble them" id="b1">Hey‚Ä¶ I have a question üò≥</div>
            <div class="bubble them" id="b2">Will you be my Valentine?</div>
            <div class="bubble me" id="b3">YES üíñ</div>
            <div class="bubble them" id="b4">Okay wow‚Ä¶ you just made my whole day üò≠üíû</div>
            <div class="bubble them" id="b5">Now I owe you a cute date.</div>
          </div>
        </div>

        <!-- Handwritten view -->
        <div id="viewLetter" style="display:none;">
          <div class="letter">
            <h3>Dear Valentine,</h3>
            <p id="l1">I was a little nervous making this‚Ä¶</p>
            <p id="l2">But I wanted to do something different and cute.</p>
            <p id="l3">So‚Ä¶ thank you for saying yes üíñ</p>
            <p id="l4">‚Äî Manav</p>
          </div>
        </div>
      </div>
    </div>
  </div>

  <script>
    /* ========= HEART RAIN ========= */
    const rain = document.getElementById("rain");
    function dropHeart(){
      const e = document.createElement("div");
      e.className = "h";
      const left = Math.random() * 100;
      const size = 10 + Math.random() * 20;
      const dur  = 2.8 + Math.random() * 4.2;

      e.style.left = left + "%";
      e.style.width = size + "px";
      e.style.height = size + "px";
      e.style.animationDuration = dur + "s";
      e.style.opacity = (0.25 + Math.random()*0.7).toFixed(2);

      rain.appendChild(e);
      setTimeout(()=>e.remove(), (dur+0.2)*1000);
    }
    setInterval(dropHeart, 160);
    for(let i=0;i<18;i++) setTimeout(dropHeart, i*90);

    /* ========= COMPATIBILITY LOADER ========= */
    const pct = document.getElementById("pct");
    const fill = document.getElementById("fill");
    const note = document.getElementById("note");
    const notes = [
      "Collecting adorable evidence‚Ä¶",
      "Running romance algorithm‚Ä¶",
      "Checking snack compatibility‚Ä¶",
      "Finalizing results‚Ä¶"
    ];
    let p = 0, ni = 0;
    const t = setInterval(()=>{
      p += Math.floor(2 + Math.random()*6);
      if(p > 100) p = 100;
      pct.textContent = p + "%";
      fill.style.width = p + "%";

      if (p % 25 < 6 && ni < notes.length){
        note.textContent = notes[ni++];
      }
      if(p === 100){
        clearInterval(t);
        note.textContent = "MATCH: 100% ‚úÖ (officially confirmed)";
      }
    }, 120);

    /* ========= HEARTBEAT (NO MP3) =========
       iOS blocks audio until user interacts: so we start on first click.
    */
    let audioStarted = false;
    let audioCtx, osc, gain;
    function startHeartbeat(){
      if(audioStarted) return;
      audioStarted = true;

      audioCtx = new (window.AudioContext || window.webkitAudioContext)();
      gain = audioCtx.createGain();
      gain.gain.value = 0.0;
      gain.connect(audioCtx.destination);

      osc = audioCtx.createOscillator();
      osc.type = "sine";
      osc.frequency.value = 55; // low thump
      osc.connect(gain);
      osc.start();

      // pulse pattern: thump-thump ... pause
      function pulse(){
        if(!audioStarted) return;
        const now = audioCtx.currentTime;

        // First thump
        gain.gain.cancelScheduledValues(now);
        gain.gain.setValueAtTime(0.0, now);
        gain.gain.linearRampToValueAtTime(0.06, now + 0.02);
        gain.gain.linearRampToValueAtTime(0.0, now + 0.12);

        // Second thump
        gain.gain.setValueAtTime(0.0, now + 0.16);
        gain.gain.linearRampToValueAtTime(0.045, now + 0.18);
        gain.gain.linearRampToValueAtTime(0.0, now + 0.30);

        setTimeout(pulse, 900);
      }
      pulse();
    }
    document.addEventListener("click", startHeartbeat, { once:true });
    document.addEventListener("touchstart", startHeartbeat, { once:true, passive:true });

    /* ========= FIREWORKS ========= */
    const fx = document.getElementById("fx");
    function fireworks(x, y){
      const colors = ["#ff4d8d","#ff85b3","#ffd1e3","#ffcc66","#a7f3d0","#93c5fd","#c4b5fd"];
      for(let i=0;i<44;i++){
        const s = document.createElement("div");
        s.className = "spark";
        s.style.left = x + "px";
        s.style.top  = y + "px";
        s.style.background = colors[Math.floor(Math.random()*colors.length)];
        s.style.setProperty("--dx", (Math.random()*520 - 260) + "px");
        s.style.setProperty("--dy", (Math.random()*420 - 240) + "px");
        fx.appendChild(s);
        setTimeout(()=>s.remove(), 950);
      }
    }

    /* ========= BUTTON LOGIC ========= */
    const yes = document.getElementById("yes");
    const no  = document.getElementById("no");
    const area = document.getElementById("area");
    const result = document.getElementById("result");

    // (2) No transforms into Yes
    const noStages = ["No üôà", "Maybe‚Ä¶ üò≥", "Hmm‚Ä¶ ü§î", "Are you sure? ü•∫", "Ok fine‚Ä¶ YES üòç"];
    let noIndex = 0;

    function moveNoSoft(){
      const A = area.getBoundingClientRect();
      const B = no.getBoundingClientRect();
      const maxX = Math.max(0, A.width - B.width);
      const maxY = Math.max(0, A.height - B.height);
      no.style.position = "absolute";
      no.style.left = (Math.random() * maxX) + "px";
      no.style.top  = (Math.random() * maxY) + "px";
    }

    no.addEventListener("click", ()=>{
      noIndex = Math.min(noIndex + 1, noStages.length - 1);
      no.textContent = noStages[noIndex];

      if(noIndex === noStages.length - 1){
        yes.click();
        return;
      }
      moveNoSoft();
      result.textContent = "That button is‚Ä¶ changing its mind üò≠";
    });

    /* ========= SECRET LETTER MODAL ========= */
    const modalBg = document.getElementById("modalBg");
    const closeModal = document.getElementById("closeModal");
    const tabMsg = document.getElementById("tabMsg");
    const tabLetter = document.getElementById("tabLetter");
    const viewMsg = document.getElementById("viewMsg");
    const viewLetter = document.getElementById("viewLetter");

    function openModal(){
      modalBg.style.display = "flex";
    }
    function hideModal(){
      modalBg.style.display = "none";
    }
    closeModal.addEventListener("click", hideModal);
    modalBg.addEventListener("click", (e)=>{ if(e.target === modalBg) hideModal(); });

    tabMsg.addEventListener("click", ()=>{
      tabMsg.classList.add("active");
      tabLetter.classList.remove("active");
      viewMsg.style.display = "block";
      viewLetter.style.display = "none";
    });
    tabLetter.addEventListener("click", ()=>{
      tabLetter.classList.add("active");
      tabMsg.classList.remove("active");
      viewMsg.style.display = "none";
      viewLetter.style.display = "block";
    });

    /* ========= YES ========= */
    yes.addEventListener("click", ()=>{
      document.getElementById("title").textContent = "It‚Äôs a date!! üíò";
      document.getElementById("sub").textContent = "Okay‚Ä¶ I‚Äôm smiling too much right now.";

      result.textContent = "Secret message unlocked. Open it üò≥üëá";

      const r = yes.getBoundingClientRect();
      const x = r.left + r.width/2;
      const y = r.top + r.height/2;
      fireworks(x, y);
      setTimeout(()=>fireworks(x+35,y-10), 160);
      setTimeout(()=>fireworks(x-35,y-15), 290);

      no.disabled = true;
      no.style.opacity = 0.55;
      no.style.cursor = "not-allowed";

      openModal();
    });

    /* Make iMessage ‚ÄúToday‚Äù show local day */
    const msgTime = document.getElementById("msgTime");
    try{
      const d = new Date();
      msgTime.textContent = d.toLocaleDateString(undefined, { weekday:"long" });
    }catch(e){}
  </script>
</body>
</html>
